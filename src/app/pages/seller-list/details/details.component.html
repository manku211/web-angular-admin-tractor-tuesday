<app-details-card [userInfo]="userInfo"></app-details-card>
<nz-card class="detail-outer-card">
  <nz-flex [nzGap]="40">
    <nz-card class="info-card">
      <div nz-flex [nzGap]="10">
        <img src="assets/icons/invest.svg" alt="invest" />
        <nz-flex [nzVertical]="true">
          <span class="thin-text">Total Invested Amount</span>
          <span class="info-value">${{ userInfo?.totalInvestedAmount }}</span>
        </nz-flex>
      </div>
    </nz-card>
    <nz-card class="info-card">
      <div nz-flex [nzGap]="10">
        <img src="assets/icons/win.svg" alt="win" />
        <nz-flex [nzVertical]="true">
          <span class="thin-text">Total Winning Bid</span>
          <span class="info-value"
            >{{ userInfo?.winCount }}/{{ userInfo?.totalListedTractors }}</span
          >
        </nz-flex>
      </div>
    </nz-card>
  </nz-flex>

  <nz-tabset (nzSelectedIndexChange)="onTabChange($event)">
    <nz-tab nzTitle="Auction Request"
      ><app-table-view
        [data]="auctionInfo"
        [columns]="listOfColumns"
        [enablePagination]="true"
        [enableSorting]="true"
        [enableSearch]="false"
        [enableActions]="true"
        (sortChange)="onSortChange($event)"
        [loader]="loader"
        [totalRecords]="totalRecords"
        [tableRowTemplate]="tableRowTemplate"
        (pageChange)="onPageChange($event)"
        (search)="onSearchInput($event)"
        [isDetailTable]="true"
        (filteredList)="onFilterHandler($event)"
      >
        <ng-template #tableRowTemplate let-data let-columns="columns">
          <tr *ngFor="let item of data">
            <td>
              <div nz-flex nzAlign="center">
                <img
                  src="assets/icons/profile_container.svg"
                  alt="profile"
                  width="40"
                  height="40"
                />
                <img
                  [src]="item?.exteriorImageUrl || 'assets/icons/Tractor.png'"
                  class="tractor-picture"
                  alt="profile"
                />
                &nbsp;<span>{{ item["tractorId"]?.name }}</span>
              </div>
            </td>
            <td>{{ item["tractorId"]?.category }}</td>
            <td>{{ item["tractorId"]?.vin }}</td>
            <td>
              <span
                class="status-button"
                [ngStyle]="
                  item['reservedPrice'] > 0
                    ? { background: '#2FC07C', color: '#fff' }
                    : { background: '#097F54', color: '#fff' }
                "
              >
                {{ item["reservedPrice"] > 0 ? "Reserved" : "No Reserve" }}
              </span>
            </td>
            <td>{{ item["createdAt"] | date : "dd-MM-yyyy" }}</td>
            <td>{{ item["currentBid"]?.amount }}</td>
            <td>
              <div nz-flex nzGap="small">
                <button
                  nz-button
                  (click)="handleRequest(item, 'accept')"
                  class="secondary_button"
                  [disabled]="item['isApprovedByAdmin']"
                >
                  {{ item["isApprovedByAdmin"] ? "Approved" : "Approve" }}
                </button>
                <button
                  nz-button
                  (click)="handleRequest(item, 'deny')"
                  class="secondary_button"
                >
                  Deny
                </button>
              </div>
            </td>
          </tr>
        </ng-template>
      </app-table-view></nz-tab
    >
    <nz-tab nzTitle="Auction Listing">
      <ng-template nz-tab>
        <app-table-view
          [data]="auctionInfo"
          [columns]="listOfColumns"
          [enablePagination]="true"
          [enableSorting]="true"
          [enableSearch]="false"
          [enableActions]="true"
          (sortChange)="onSortChange($event)"
          [loader]="loader"
          [totalRecords]="totalRecords"
          [tableRowTemplate]="tableRowTemplate"
          (pageChange)="onPageChange($event)"
          (search)="onSearchInput($event)"
          (filteredList)="onFilterHandler($event)"
          [isDetailTable]="true"
        >
          <ng-template #tableRowTemplate let-data let-columns="columns">
            <tr *ngFor="let item of data">
              <td>
                <div nz-flex nzAlign="center">
                  <img
                    src="assets/icons/profile_container.svg"
                    alt="profile"
                    width="40"
                    height="40"
                  />
                  <img
                    [src]="item?.exteriorImageUrl || 'assets/icons/Tractor.png'"
                    class="tractor-picture"
                    alt="profile"
                  />
                  &nbsp;<span>{{ item["tractorId"]?.name }}</span>
                </div>
              </td>
              <td>{{ item["tractorId"]?.category }}</td>
              <td>{{ item["tractorId"]?.vin }}</td>
              <td>
                <span
                  class="status-button"
                  [ngStyle]="
                    item['reservedPrice'] > 0
                      ? { background: '#2FC07C', color: '#fff' }
                      : { background: '#097F54', color: '#fff' }
                  "
                >
                  {{ item["reservedPrice"] > 0 ? "Reserved" : "No Reserve" }}
                </span>
              </td>
              <td>
                <span
                  [ngStyle]="styleObject(item['auctionStatus'])"
                  class="status-button"
                  >{{ item["auctionStatus"] | titlecase }}</span
                >
              </td>
              <td>{{ item["createdAt"] | date : "dd-MM-yyyy" }}</td>
              <td>{{ item["currentBid"]?.amount }}</td>
              <td>
                <button
                  nz-button
                  (click)="handleViewMore(item['_id'])"
                  class="secondary_button"
                >
                  View More
                </button>
              </td>
            </tr>
          </ng-template>
        </app-table-view>
      </ng-template></nz-tab
    >
  </nz-tabset>
</nz-card>
<div *ngIf="openDenialModal">
  <app-deny-modal
    (handleClose)="handleClose()"
    [tractorData]="tractorData"
  ></app-deny-modal>
</div>
<div *ngIf="openApproveModal">
  <app-approve-modal
    (handleClose)="handleClose()"
    [tractorData]="tractorData"
  ></app-approve-modal>
</div>
